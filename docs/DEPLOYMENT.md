# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

MoteTalkãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹æ‰‹é †ã§ã™ã€‚

## ğŸš€ Renderã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. å‰ææ¡ä»¶

- GitHubãƒªãƒã‚¸ãƒˆãƒªãŒæº–å‚™æ¸ˆã¿
- Renderã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆæ¸ˆã¿
- å¿…è¦ãªAPIã‚­ãƒ¼ãŒå–å¾—æ¸ˆã¿

### 2. Renderã§ã®ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ

#### 2.1 æ–°ã—ã„Webã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆ

1. [Render Dashboard](https://dashboard.render.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒNew +ã€â†’ã€ŒWeb Serviceã€ã‚’é¸æŠ
3. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’æ¥ç¶š

#### 2.2 åŸºæœ¬è¨­å®š

| é …ç›® | å€¤ | èª¬æ˜ |
|------|----|----|
| **Name** | motetalk-app | ã‚µãƒ¼ãƒ“ã‚¹å |
| **Environment** | Node | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒ |
| **Region** | Oregon (US West) | ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆæ¨å¥¨ï¼‰ |
| **Branch** | main | ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒ |

#### 2.3 ãƒ“ãƒ«ãƒ‰è¨­å®š

| é …ç›® | å€¤ | èª¬æ˜ |
|------|----|----|
| **Build Command** | `npm install && npm run build` | ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ |
| **Start Command** | `node server/index.js` | èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ |

**è¨­å®šã®èª¬æ˜:**
- **Build Command**: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰
- **Start Command**: Express.jsã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’çµ±åˆé…ä¿¡ï¼‰

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

Renderãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€ŒEnvironmentã€ã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

#### 3.1 å¿…é ˆç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|----|
| `NODE_ENV` | ç’°å¢ƒè¨­å®š | `production` |
| `STRIPE_SECRET_KEY` | Stripeç§˜å¯†ã‚­ãƒ¼ | `sk_test_...` |
| `FIREBASE_PROJECT_ID` | Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID | `mote-talk-bbce1` |
| `FIREBASE_CLIENT_EMAIL` | Firebase Adminç”¨ãƒ¡ãƒ¼ãƒ« | `firebase-adminsdk-...` |
| `FIREBASE_PRIVATE_KEY` | Firebase Adminç”¨ç§˜å¯†ã‚­ãƒ¼ | `-----BEGIN PRIVATE KEY-----...` |

#### 3.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|----|
| `VITE_GEMINI_API_KEY` | Gemini APIã‚­ãƒ¼ | `AIzaSy...` |
| `VITE_STRIPE_PUBLISHABLE_KEY` | Stripeå…¬é–‹ã‚­ãƒ¼ | `pk_test_...` |
| `VITE_FIREBASE_API_KEY` | Firebase APIã‚­ãƒ¼ | `AIzaSy...` |
| `VITE_FIREBASE_AUTH_DOMAIN` | Firebaseèªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ | `mote-talk-bbce1.firebaseapp.com` |
| `VITE_FIREBASE_PROJECT_ID` | Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID | `mote-talk-bbce1` |
| `VITE_FIREBASE_STORAGE_BUCKET` | Firebaseã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒã‚±ãƒƒãƒˆ | `mote-talk-bbce1.appspot.com` |
| `VITE_FIREBASE_MESSAGING_SENDER_ID` | Firebaseãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°é€ä¿¡è€…ID | `123456789` |
| `VITE_FIREBASE_APP_ID` | Firebaseã‚¢ãƒ—ãƒªID | `1:123456789:web:...` |
| `VITE_APP_URL` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³URL | `https://motetalk-0723.onrender.com` |

### 4. ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

#### 4.1 è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

- **Auto-Deploy**: æœ‰åŠ¹
- **Branch**: main
- **Build Filter**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

#### 4.2 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

- **Health Check Path**: `/api/health`
- **Health Check Timeout**: 180ç§’

### 5. ãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Ÿè¡Œ

1. ã€ŒCreate Web Serviceã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. åˆå›ãƒ“ãƒ«ãƒ‰ãŒé–‹å§‹ã•ã‚Œã‚‹ï¼ˆ5-10åˆ†ç¨‹åº¦ï¼‰
3. ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œã€ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•

## ğŸ”§ ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### 1. åŸºæœ¬å‹•ä½œç¢ºèª

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCSS/JSï¼‰ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã‚‹
- ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl https://your-app-name.onrender.com/api/health
# æœŸå¾…çµæœ: {"status":"OK"}
```

### 2. æ©Ÿèƒ½ç¢ºèª

#### èªè¨¼æ©Ÿèƒ½
- Googleãƒ­ã‚°ã‚¤ãƒ³ãŒå‹•ä½œã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

#### AIæ©Ÿèƒ½
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ã§AIè¿”ä¿¡ãŒç”Ÿæˆã•ã‚Œã‚‹
- ä¼šè©±å±¥æ­´ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã‚‹

#### æ±ºæ¸ˆæ©Ÿèƒ½
- Stripeæ±ºæ¸ˆãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ†ã‚¹ãƒˆæ±ºæ¸ˆãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã™ã‚‹
```
npm ERR! code ELIFECYCLE
npm ERR! errno 1
```

**è§£æ±ºç­–**:
1. `package.json`ã®ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèª
2. Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªï¼ˆ18.xä»¥ä¸Šæ¨å¥¨ï¼‰
3. ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

#### 2. é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: CSS/JSãƒ•ã‚¡ã‚¤ãƒ«ãŒ404ã‚¨ãƒ©ãƒ¼
```
GET https://motetalk-0723.onrender.com/index-xxx.css 404 (Not Found)
```

**è§£æ±ºç­–**:
1. ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. `dist`ãƒ•ã‚©ãƒ«ãƒ€ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ã®è¨­å®šã‚’ç¢ºèª

#### 3. ç’°å¢ƒå¤‰æ•°ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã—ãªã„
```
Error: Cannot find module 'firebase-admin'
```

**è§£æ±ºç­–**:
1. ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. å¿…é ˆã®ç’°å¢ƒå¤‰æ•°ãŒä¸è¶³ã—ã¦ã„ãªã„ã‹ç¢ºèª
3. å€¤ã«ç‰¹æ®Šæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª

#### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

**ç—‡çŠ¶**: åˆå›èª­ã¿è¾¼ã¿ãŒé…ã„
```
First Contentful Paint: 5.2s
```

**è§£æ±ºç­–**:
1. ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®æœ€é©åŒ–
2. ç”»åƒã®åœ§ç¸®
3. CDNã®æ´»ç”¨

## ğŸ“Š ç›£è¦–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### 1. ãƒ­ã‚°ç›£è¦–

#### Renderãƒ­ã‚°ã®ç¢ºèª
1. Renderãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠ
2. ã€ŒLogsã€ã‚¿ãƒ–ã§ãƒ­ã‚°ã‚’ç¢ºèª
3. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
```javascript
// æ§‹é€ åŒ–ãƒ­ã‚°ã®å‡ºåŠ›
console.log('ğŸš€ Server running on port', PORT);
console.log('ğŸ“ Frontend served from:', path.join(__dirname, '../dist'));
console.log('ğŸ”§ Environment:', process.env.NODE_ENV);
```

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

#### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
- ã‚¨ãƒ©ãƒ¼ç‡
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- CPUä½¿ç”¨ç‡

#### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- ã‚¨ãƒ©ãƒ¼ç‡ãŒ5%ã‚’è¶…ãˆãŸå ´åˆ
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒ3ç§’ã‚’è¶…ãˆãŸå ´åˆ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒ80%ã‚’è¶…ãˆãŸå ´åˆ

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
- ç’°å¢ƒå¤‰æ•°ã®æ¼æ´©ãƒã‚§ãƒƒã‚¯
- APIã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ç¢ºèª

## ğŸ”„ ç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. GitHub Actions

#### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š
```yaml
name: Deploy to Render
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Render
        uses: johnbeynon/render-deploy-action@v1.0.0
        with:
          service-id: ${{ secrets.RENDER_SERVICE_ID }}
          api-key: ${{ secrets.RENDER_API_KEY }}
```

### 2. ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

#### Blue-Green Deployment
1. æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ¥ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
2. ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆ
3. æ—§ç’°å¢ƒã‚’å‰Šé™¤

#### Rolling Deployment
1. æ®µéšçš„ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ›´æ–°
2. ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’æœ€å°åŒ–
3. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå®¹æ˜“

## ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### 1. æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

#### è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®è¨­å®š
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å…±æœ‰ã®è¨­å®š
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ—ãƒ¼ãƒ«ã®èª¿æ•´

### 2. å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

#### ãƒªã‚½ãƒ¼ã‚¹å¢—å¼·
- CPU/ãƒ¡ãƒ¢ãƒªã®å¢—åŠ 
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã®æ‹¡å¼µ
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸã®å‘ä¸Š

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

#### æš—å·åŒ–
- æ©Ÿå¯†æƒ…å ±ã¯æš—å·åŒ–ã—ã¦ä¿å­˜
- ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®åˆ¶é™
- å®šæœŸçš„ãªãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

### 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### HTTPSå¼·åˆ¶
```javascript
// HTTPSãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
app.use((req, res, next) => {
  if (req.header('x-forwarded-proto') !== 'https') {
    res.redirect(`https://${req.header('host')}${req.url}`);
  } else {
    next();
  }
});
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

```javascript
// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      scriptSrc: ["'self'"],
    },
  },
}));
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Render Documentation](https://render.com/docs)
- [Node.js Best Practices](https://nodejs.org/en/docs/guides/)
- [Express.js Security](https://expressjs.com/en/advanced/best-practices-security.html)
- [Firebase Hosting](https://firebase.google.com/docs/hosting) 